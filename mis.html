<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management Information System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tahoma:wght@400;700&display=swap');
        body { font-family: 'Tahoma', Geneva, sans-serif; }
        /* Additional styles omitted for brevity */
    </style>
</head>
<body class="bg-gray-50 font-tahoma">
    <div class="container mx-auto px-3 py-2 max-w-6xl">
        <!-- Section Navigation Buttons -->
        <div class="mb-4 flex justify-center gap-4 flex-wrap">
            <button id="showSummaryBtn" class="custom-btn text-white py-2 px-6 rounded-md flex items-center">
                <i class="fas fa-chart-pie mr-2"></i> Summary
            </button>
            <button id="showEntryBtn" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-md flex items-center">
                <i class="fas fa-file-alt mr-2"></i> Form
            </button>
            <button id="showViewBtn" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-md flex items-center">
                <i class="fas fa-table mr-2"></i> View
            </button>
            <button id="showSearchBtn" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-md flex items-center">
                <i class="fas fa-search mr-2"></i> Find
            </button>
        </div>

        <!-- View Data Section -->
        <div id="viewSection" class="section">
            <div class="bg-white p-4 rounded-lg shadow-md">
                <div class="flex flex-wrap justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-primary">View All Records</h2>
                    <div class="flex flex-wrap gap-2 mt-2 sm:mt-0">
                        <button id="exportDataBtn" class="custom-btn text-white py-2 px-4 rounded-md flex items-center">
                            <i class="fas fa-file-export mr-2"></i> Export
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table id="dataTable" class="data-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllRows"></th>
                                <th>CID</th>
                                <th>Customer Name</th>
                                <th>Mobile</th>
                                <th>Products</th>
                                <th>Status</th>
                                <th>Points</th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize jsPDF
        window.jsPDF = window.jspdf.jsPDF;

        // Sample data (for demonstration)
        let allRecordsData = [
            { CID: "12345", "Customer Name": "John Doe", Mobile: "5551234567", Product: "Touchpoints Gold Visa", Status: "Completed", Points: "250" },
            { CID: "67890", "Customer Name": "Jane Smith", Mobile: "5559876543", Product: "Privilege 20K-30K, PL", Status: "Under Review", Points: "650" }
        ];

        // Function to truncate text
        function truncateText(text, maxLength) {
            if (!text) return '';
            return text.length > maxLength ? text.substring(0, maxLength - 3) + '...' : text;
        }

        // Export selected data as PDF
        document.getElementById('exportDataBtn').addEventListener('click', function() {
            const checkedRows = document.querySelectorAll('#dataTableBody .row-checkbox:checked');

            // Check if we have selected rows
            if (checkedRows.length === 0) {
                alert("Please select at least one record to export");
                return;
            }

            // Get selected CIDs
            const selectedCIDs = Array.from(checkedRows).map(checkbox => checkbox.dataset.cid);

            // Filter data to get only selected records
            let selectedData = allRecordsData.filter(record => selectedCIDs.includes(record.CID));

            // Prepare data for PDF with serial numbers
            const exportData = selectedData.map((record, index) => ({
                No: (index + 1).toString(),
                CID: truncateText(record.CID || '', 15),
                Date: new Date().toLocaleDateString(), // Placeholder for Date
                'Customer Name': truncateText(record['Customer Name'] || '', 25),
                Product: truncateText(record.Product || '', 30),
                Status: truncateText(record.Status || '', 15)
            }));

            // Generate PDF
            generatePDF(exportData);
        });

        // Function to generate PDF
        function generatePDF(data) {
            const doc = new jsPDF();
            doc.setFontSize(18);
            doc.setTextColor(111, 44, 79);
            doc.text('Customer Data Report', 15, 15);
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 15, 25);

            // Define column widths
            const colWidths = [20, 30, 40, 50, 40, 30];
            let y = 35;

            // Add header
            const headers = ['No', 'CID', 'Date', 'Customer Name', 'Product', 'Status'];
            doc.setFillColor(111, 44, 79);
            doc.rect(15, y - 5, colWidths.reduce((a, b) => a + b, 0), 8, 'F');
            doc.setTextColor(255, 255, 255);
            headers.forEach((header, i) => {
                doc.text(header, 15 + colWidths.slice(0, i).reduce((a, b) => a + b, 0), y);
            });

            // Reset font color for data
            doc.setTextColor(0, 0, 0);
            y += 10;

            // Add data rows
            data.forEach((row) => {
                doc.text(row.No, 15, y);
                doc.text(row.CID, 15 + colWidths[0], y);
                doc.text(row.Date, 15 + colWidths[0] + colWidths[1], y);
                doc.text(row['Customer Name'], 15 + colWidths[0] + colWidths[1] + colWidths[2], y);
                doc.text(row.Product, 15 + colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3], y);
                doc.text(row.Status, 15 + colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3] + colWidths[4], y);
                y += 10; // Move to the next row
            });

            // Save the PDF
            doc.save('customer_data_report.pdf');
        }
    </script>
</body>
</html>